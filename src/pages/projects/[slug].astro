---
import { getCollection } from "astro:content";
import NextProjectButton from "../../components/NextProjectButton.astro";
import BasicLayout from "../../layouts/BasicLayout.astro";
import MediaViewer from "../../components/MediaViewer.astro";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((project, idx) => {
    // Compute next project's index (wrap to first if last)
    const nextIdx = (idx + 1) % projects.length;
    const nextProject = projects[nextIdx];
    return {
      params: { slug: project.id },
      props: { project, nextProject },
    };
  });
}

const { project, nextProject } = Astro.props;
---

<BasicLayout
  title={project.data.projectName}
  description={project.data.shortDescription}
>
  <main>
    <article class="project-detail">
      {
        project.data.thumbnailImage && (
          <div class="project-thumbnail">
            <MediaViewer
              src={project.data.thumbnailImage}
              alt={`${project.data.projectName} thumbnail`}
              title="Thumbnail"
            />
          </div>
        )
      }

      <header class="project-header">
        <div class="left-column">
          <div class="project-title">
            <h1>{project.data.projectName}</h1>
          </div>

          <div class="project-meta">
            <span class="category">{project.data.categories}</span>
            <span class="year">{project.data.year}</span>
          </div>

          {
            project.data.role && (
              <div class="role">Role: {project.data.role}</div>
            )
          }
        </div>

        <div class="right-column">
          <p class="short-description">{project.data.shortDescription}</p>
        </div>
      </header>

      <div class="project-content">
        {
          project.data.credit && (
            <div class="credit">
              <h3>Credits</h3>
              <p>{project.data.credit}</p>
            </div>
          )
        }

        <!-- {
          project.data.heroMoment && (
            <div class="hero-moment">
              <h3>Hero Moment</h3>
              <p>{project.data.heroMoment}</p>
            </div>
          )
        } -->

        <div class="media-gallery">
          {
            project.data.workImage1 && (
              <MediaViewer
                src={project.data.workImage1}
                alt={`${project.data.projectName} work sample 1`}
                title="Work Sample 1"
                description={project.data.workImage1Description}
              />
            )
          }
          {
            project.data.workImage2 && (
              <MediaViewer
                src={project.data.workImage2}
                alt={`${project.data.projectName} work sample 2`}
                title="Work Sample 2"
                description={project.data.workImage2Description}
              />
            )
          }
          {
            project.data.workImage3 && (
              <MediaViewer
                src={project.data.workImage3}
                alt={`${project.data.projectName} work sample 3`}
                title="Work Sample 3"
                description={project.data.workImage3Description}
              />
            )
          }
          {
            project.data.workImage4 && (
              <MediaViewer
                src={project.data.workImage4}
                alt={`${project.data.projectName} work sample 4`}
                title="Work Sample 4"
                description={project.data.workImage4Description}
              />
            )
          }
          {
            project.data.workImage5 && (
              <MediaViewer
                src={project.data.workImage5}
                alt={`${project.data.projectName} work sample 5`}
                title="Work Sample 5"
                description={project.data.workImage5Description}
              />
            )
          }
          {
            project.data.workImage6 && (
              <MediaViewer
                src={project.data.workImage6}
                alt={`${project.data.projectName} work sample 6`}
                title="Work Sample 6"
                description={project.data.workImage6Description}
              />
            )
          }
          {
            project.data.workImage7 && (
              <MediaViewer
                src={project.data.workImage7}
                alt={`${project.data.projectName} work sample 7`}
                title="Work Sample 7"
                description={project.data.workImage7Description}
              />
            )
          }
          {
            project.data.workImage8 && (
              <MediaViewer
                src={project.data.workImage8}
                alt={`${project.data.projectName} work sample 8`}
                title="Work Sample 8"
                description={project.data.workImage8Description}
              />
            )
          }
          {
            project.data.workImage9 && (
              <MediaViewer
                src={project.data.workImage9}
                alt={`${project.data.projectName} work sample 9`}
                title="Work Sample 9"
                description={project.data.workImage9Description}
              />
            )
          }
          {
            project.data.workImage10 && (
              <MediaViewer
                src={project.data.workImage10}
                alt={`${project.data.projectName} work sample 10`}
                title="Work Sample 10"
                description={project.data.workImage10Description}
              />
            )
          }
        </div>
      </div>
    </article>
    <NextProjectButton nextProject={nextProject} />
  </main>
</BasicLayout>
